graph TB
    subgraph "ğŸŸ¥ RÃ©seau sql_Spring"
        NGINX[Nginx<br/> ğŸŒ Port externe: 80]
        APP1[spring-app_1<br/>ğŸ”’ Port interne: 8080]
        APP2[spring-app_2<br/>ğŸ”’ Port interne: 8080]
    end

    subgraph "ğŸŸ§ RÃ©seau sql_PHPAdmin"
        PMA[PHPMyAdmin<br/> ğŸŒ Port externe: 20000]
    end

    subgraph "ğŸŸ¨ RÃ©seau sql_Backup"
        BACKUP[mysql-backup<br/>Sauvegarde toutes les 12h]
    end

    subgraph "ğŸ”µ RÃ©seau sonar_network"
        SONAR[SonarQube<br/> ğŸŒ Port externe: 9000]
        SONARDB[(PostgreSQL 17<br/>ğŸ”’ Port interne: 5432)]
        SCANNER[sonar-maven-scanner<br/>Profile: scan]
    end

    %% MySQL au centre connectÃ© aux 3 rÃ©seaux
    subgraph "ConnectÃ© aux 3 rÃ©seaux ğŸŸ¨/ğŸŸ§/ğŸŸ¥"
        MYSQL[(MySQL 8.4<br/>ğŸ”’ Port interne: 3306<br/>Healthcheck actif)]
    end

    %% Connexions rÃ©seau sql_Spring
    NGINX -->|Load Balancing| APP1
    NGINX -->|Load Balancing| APP2
    APP1 -->|JDBC| MYSQL
    APP2 -->|JDBC| MYSQL

    %% Connexions rÃ©seau sql_PHPAdmin
    PMA -->|Gestion DB| MYSQL

    %% Connexions rÃ©seau sql_Backup
    BACKUP -->|Backup pÃ©riodique| MYSQL

    %% Connexions rÃ©seau sonar_network
    SCANNER -->|Analyse code| SONAR
    SONAR -->|Stockage| SONARDB

    %% Volumes persistants
    MYSQL -.->|Volume| V1[db_data]
    SONARDB -.->|Volume| V2[sonar_db_data]
    SONAR -.->|Volume| V3[sonar_data]
    SONAR -.->|Volume| V4[sonar_extensions]
    SONAR -.->|Volume| V5[sonar_logs]
    SCANNER -.->|Volume| V6[maven_cache]
    BACKUP -.->|Volume| V7[./backups]

    %% Fichiers montÃ©s
    NGINX -.->|Mount ro| F1[./nginx.conf]
    MYSQL -.->|Mount ro| F2[./monannuaire_mysql.sql]
    BACKUP -.->|Mount ro| F3[./backup.sh]

    %% LÃ©gende
    classDef database fill:#f9f,stroke:#333,stroke-width:2px,color:#000
    classDef service fill:#bbf,stroke:#333,stroke-width:2px,color:#000
    classDef volume fill:#efe,stroke:#333,stroke-width:1px,stroke-dasharray: 5 5,color:#000
    classDef file fill:#ffe,stroke:#333,stroke-width:1px,stroke-dasharray: 3 3,color:#000

    class MYSQL,SONARDB database
    class NGINX,APP1,APP2,PMA,BACKUP,SONAR,SCANNER service
    class V1,V2,V3,V4,V5,V6,V7 volume
    class F1,F2,F3 file